<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.3"?>

<!-- 
/*******************************************************************************
 * Copyright (c) 2005-2008 VecTrace (Zingo Andersen) and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *     VecTrace (Zingo Andersen) - implementation
 *     Software Balm Consulting Inc (Peter Hunnisett <peter_hge at softwarebalm dot com>) - some updates
 *     StefanC                   - Some updates
 *     Charles O'Farrell         - Annotation with color
 *     Jerome Negre              - Moving menus around
 *     Sebastian                 - Better naming
 *     Bastian Doetsch           - RepositoryProviderType for ProjectSets
 *******************************************************************************/
-->

<plugin>

<!--            Team exstension points                     -->
   <extension point="org.eclipse.team.core.repository">
	  <repository
    	 class="com.vectrace.MercurialEclipse.team.MercurialTeamProvider"
    	 typeClass="com.vectrace.MercurialEclipse.team.MercurialTeamProviderType"
		 id="com.vectrace.MercurialEclipse.team.MercurialTeamProvider"
		  metaFilePaths=".hg/">
 	  </repository>
   </extension>
   
	<extension point="org.eclipse.team.ui.configurationWizards">
	   <wizard
	        name="Mercurial"
	        icon="icons/mercurialeclipse.png"
	        class="com.vectrace.MercurialEclipse.team.MercurialConfigurationWizard"
	        id="com.vectrace.MercurialEclipse.team.MercurialConfigurationWizard">
	   </wizard>
	</extension>
		
     
	<extension point="org.eclipse.team.ui.synchronizeParticipants">
	   <participant
	        icon="icons/mercurialeclipse.png"
	        id="com.vectrace.MercurialEclipse.synchronize.MercurialSynchronizeParticipant"
	        class="com.vectrace.MercurialEclipse.synchronize.MercurialSynchronizeParticipant"
	        name="Mercurial Synchronization"
	        persistent="true">
	   </participant>
	</extension>

	<extension point= "org.eclipse.team.ui.synchronizeWizards" >
	   <wizard
	        name="Mercurial"
			description="Mercurial synchronize wizard"
	        icon="icons/mercurialeclipse.png"
	        class="com.vectrace.MercurialEclipse.wizards.MercurialParticipantSynchronizeWizard"
	        id="com.vectrace.MercurialEclipse.wizards.MercurialParticipantSynchronizeWizard">
	   </wizard>
	</extension>


	<extension point="org.eclipse.ui.decorators">
	    <decorator
	            adaptable="true"
	            label="Mercurial Eclipse decorations"
	            state="false"
	            lightweight= "true"
	            location= "BOTTOM_RIGHT"
	            class="com.vectrace.MercurialEclipse.team.ResourceDecorator"
	            id="com.vectrace.MercurialEclipse.team.ResourceDecorator">
	         <description>
	            Label decorations for Mercurial eclipse plugin.
	         </description>
	         <enablement>
               <objectClass name="org.eclipse.core.resources.IResource"/>                                              
	         </enablement>
	    </decorator>
	</extension>

	<!-- propertyTesters -->
	<extension point="org.eclipse.core.expressions.propertyTesters">
		<!-- tests for added,clean,deleted,ignore,modified,removed,unknown -->
	  	<propertyTester
	         class="com.vectrace.MercurialEclipse.menu.FlagPropertyTester"
	         id="com.vectrace.MercurialEclipse.propertyTester"
	         namespace="com.vectrace.MercurialEclipse.propertyTester"
	         properties="status"
	         type="org.eclipse.core.resources.IResource">
	  	</propertyTester>
	</extension>
	
	<!-- expressions.definitions -->
	<extension point="org.eclipse.core.expressions.definitions">
		<!-- mercurial -->
		<definition id="com.vectrace.MercurialEclipse.def.mercurial">
			<iterate>
				<adapt type="org.eclipse.core.resources.IResource">
					<test
					      property="org.eclipse.core.resources.projectPersistentProperty"
					      args="org.eclipse.team.core.repository,com.vectrace.MercurialEclipse.team.MercurialTeamProvider">
					</test>
				</adapt>
			</iterate>
		</definition>
		<!-- Must be file -->
		<definition id="com.vectrace.MercurialEclipse.def.file">
			<iterate>
				<adapt type="org.eclipse.core.resources.IResource">
					<adapt type="org.eclipse.core.resources.IFile"/>
				</adapt>
			</iterate>
		</definition>
		<!-- notInMercurial -->
		<definition id="com.vectrace.MercurialEclipse.def.notInMercurial">
			<iterate>
				<adapt type="org.eclipse.core.resources.IResource">					
						<test 
						      property="com.vectrace.MercurialEclipse.propertyTester.status"
						      args="unknown,ignore">
						</test>
				</adapt>
			</iterate>
		</definition>
		<!-- hgUnknown -->
		<definition id="com.vectrace.MercurialEclipse.def.hgUnknown">
			<iterate>
				<adapt type="org.eclipse.core.resources.IResource">
		    	       	<test property="com.vectrace.MercurialEclipse.propertyTester.status"
	    		              args="unknown"/>
						<not>
							<test property="com.vectrace.MercurialEclipse.propertyTester.status"
						      args="added,clean,modified"/>
						</not>
				</adapt>
			</iterate>
		</definition>
		<!-- merging -->
		<definition id="com.vectrace.MercurialEclipse.def.merging">
			<iterate>
				<adapt type="org.eclipse.core.resources.IResource">
					<test
					      property="org.eclipse.core.resources.projectPersistentProperty"
					      args="com.vectrace.MercurialEclipse.merging">
					</test>
				</adapt>
			</iterate>
		</definition>
		<!-- notMerging -->
		<definition id="com.vectrace.MercurialEclipse.def.notMerging">
			<iterate>
				<adapt type="org.eclipse.core.resources.IResource">
					<not>
						<test
						      property="org.eclipse.core.resources.projectPersistentProperty"
						      args="com.vectrace.MercurialEclipse.merging">
						</test>
					</not>
				</adapt>
			</iterate>
		</definition>
	</extension>

	<!-- commands -->
	<extension point="org.eclipse.ui.commands">
		<command
        		categoryId="com.vectrace.MercurialEclipse.commandCategory"
		        id="com.vectrace.MercurialEclipse.menu.CommitMergeHandler"
		        name="Commit Merge..."/>
		<command id="com.vectrace.MercurialEclipse.menu.CommitHandler"
				 categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Commit..."/>
		<command id="com.vectrace.MercurialEclipse.menu.UpdateHandler"
				categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Update"/>
		<command id="com.vectrace.MercurialEclipse.menu.TagHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Tags..."/>
		<command id="com.vectrace.MercurialEclipse.menu.BookmarkHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"
                 name="Bookmarks..."/>
        <command id="com.vectrace.MercurialEclipse.menu.MergeHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Merge..."/>
		<command id="com.vectrace.MercurialEclipse.menu.SwitchHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Update To..."/>
		<command id="com.vectrace.MercurialEclipse.menu.ShowAnnotationHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Show Annotation"/>
		<command id="com.vectrace.MercurialEclipse.menu.AddHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Add..."/>
		<command id="com.vectrace.MercurialEclipse.menu.HgIgnoreHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Ignore..."/>
		<command id="com.vectrace.MercurialEclipse.menu.RollbackHandler"
		         name="Rollback"/>		
		<command id="com.vectrace.MercurialEclipse.menu.PullHandler"
				 categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Pull..."/>
		<command id="com.vectrace.MercurialEclipse.menu.PushHandler"
				 categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Push..."/>
        <command id="com.vectrace.MercurialEclipse.menu.RebaseHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"
                 name="Rebase..."/>       		         		
		<command id="com.vectrace.MercurialEclipse.menu.SignHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Sign..."/>	                  
		<command id="com.vectrace.MercurialEclipse.menu.BackoutHandler"
		         categoryId="com.vectrace.MercurialEclipse.commandCategory"
		         name="Backout..."/>		
        <command id="com.vectrace.MercurialEclipse.menu.TransplantHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"
                 name="Transplant..."/>
        <command id="com.vectrace.MercurialEclipse.menu.StripHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Strip..."/>
        <command id="com.vectrace.MercurialEclipse.menu.ServeHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Serve..."/>
        <command id="com.vectrace.MercurialEclipse.menu.AddBranchHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Branch..."/>
        <command id="com.vectrace.MercurialEclipse.menu.DisconnectHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Disconnect"/>        
        <command id="com.vectrace.MercurialEclipse.menu.QImportHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"
                 name="Qimport..."/>
        <command id="com.vectrace.MercurialEclipse.menu.QInitHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Qinit..."/>
        <command id="com.vectrace.MercurialEclipse.menu.QNewHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Qnew..."/>                                         
        <command id="com.vectrace.MercurialEclipse.menu.QRefreshHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Qrefresh..."/>
        <command id="com.vectrace.MercurialEclipse.menu.QDeleteHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Qdelete..."/>            
        <command id="com.vectrace.MercurialEclipse.menu.SyncHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Synchronize..."/>                      
        <command id="com.vectrace.MercurialEclipse.menu.RefreshStatusHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory"        
                 name="Refresh Status"/>
        <command id="com.vectrace.MercurialEclipse.menu.ExportPatchHandler"
                 categoryId="com.vectrace.MercurialEclipse.commandCategory" 
                 description="Export patch to file (hg diff)"
                 name="E&amp;xport Patch..."/>
        <category
              id="com.vectrace.MercurialEclipse.commandCategory"
              name="Mercurial">
        </category>                                       
	</extension>

	<!-- handlers -->
	<extension point="org.eclipse.ui.handlers">

		<!-- CommitMergeHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.CommitMergeHandler"
		         class="com.vectrace.MercurialEclipse.menu.CommitMergeHandler">
			<enabledWhen>
				<count value="1"/>
			</enabledWhen>
		</handler>

		<!-- CommitHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.CommitHandler"
		         class="com.vectrace.MercurialEclipse.menu.CommitHandler"/>

		<!-- PushHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.PushHandler"
		         class="com.vectrace.MercurialEclipse.menu.PushHandler">
			<enabledWhen>
				<count value="1"/>
			</enabledWhen>
		</handler>

		<!-- UpdateHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.UpdateHandler"
		         class="com.vectrace.MercurialEclipse.menu.UpdateHandler">
			<enabledWhen>
				<count value="1"/>
			</enabledWhen>
		</handler>
		
		<!-- RebaseHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.RebaseHandler"
                 class="com.vectrace.MercurialEclipse.menu.RebaseHandler">
            <enabledWhen>
                <count value="1"/>
            </enabledWhen>
        </handler>
		
		<!-- PullHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.PullHandler"
		         class="com.vectrace.MercurialEclipse.menu.PullHandler">
			<enabledWhen>
				<count value="1"/>
			</enabledWhen>
		</handler>				

		<!-- TagHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.TagHandler"
		         class="com.vectrace.MercurialEclipse.menu.TagHandler">
			<enabledWhen>
				<count value="1"/>
			</enabledWhen>
		</handler>
		
		<!-- BookmarkHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.BookmarkHandler"
                 class="com.vectrace.MercurialEclipse.menu.BookmarkHandler">
            <enabledWhen>
                <count value="1"/>
            </enabledWhen>
        </handler>

		<!-- MergeHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.MergeHandler"
		         class="com.vectrace.MercurialEclipse.menu.MergeHandler">
			<enabledWhen>
				<and>
					<count value="1"/>
					<reference definitionId="com.vectrace.MercurialEclipse.def.notMerging"/>
				</and>
			</enabledWhen>
		</handler>

		<!-- SwitchHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.SwitchHandler"
		         class="com.vectrace.MercurialEclipse.menu.SwitchHandler">
			<enabledWhen>
				<count value="1"/>
			</enabledWhen>
		</handler>

		<!-- GLogHandler -->
		<!--handler commandId="com.vectrace.MercurialEclipse.menu.GLogHandler"
		         class="com.vectrace.MercurialEclipse.menu.GLogHandler">
			<enabledWhen>
				<count value="1"/>
			</enabledWhen>
		</handler-->

		<!-- ShowAnnotationHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.ShowAnnotationHandler"
		         class="com.vectrace.MercurialEclipse.menu.ShowAnnotationHandler">
			<enabledWhen>				
					<count value="1"/>
			</enabledWhen>
		</handler>
		
		<!-- AddHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.AddHandler"
		         class="com.vectrace.MercurialEclipse.menu.AddHandler">
			<enabledWhen>
				<reference definitionId="com.vectrace.MercurialEclipse.def.hgUnknown"/>
			</enabledWhen>
		</handler>

		<!-- HgIgnoreHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.HgIgnoreHandler"
		         class="com.vectrace.MercurialEclipse.menu.HgIgnoreHandler">
			<enabledWhen>
				<and>
					<count value="1"/>
					<reference definitionId="com.vectrace.MercurialEclipse.def.hgUnknown"/>
				</and>
			</enabledWhen>
		</handler>
		<!-- SyncHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.SyncHandler"
                 class="com.vectrace.MercurialEclipse.menu.SyncHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
		<!-- RollbackHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.RollbackHandler"
		         class="com.vectrace.MercurialEclipse.menu.RollbackHandler">
			<enabledWhen>
				<and>
					<count value="1"/>					
				</and>
			</enabledWhen>
		</handler>
		
		<!-- BackoutHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.BackoutHandler"
		         class="com.vectrace.MercurialEclipse.menu.BackoutHandler">
			<enabledWhen>
				<and>
					<count value="1"/>					
				</and>
			</enabledWhen>
		</handler>
		
		<!-- SignHandler -->
		<handler commandId="com.vectrace.MercurialEclipse.menu.SignHandler"
		         class="com.vectrace.MercurialEclipse.menu.SignHandler">
			<enabledWhen>
				<and>
					<count value="1"/>					
				</and>
			</enabledWhen>
		</handler>
		
	    <!-- TransplantHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.TransplantHandler"
                 class="com.vectrace.MercurialEclipse.menu.TransplantHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        
        <!-- StripHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.StripHandler"
                 class="com.vectrace.MercurialEclipse.menu.StripHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- ServeHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.ServeHandler"
                 class="com.vectrace.MercurialEclipse.menu.ServeHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- AddBranchHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.AddBranchHandler"
                 class="com.vectrace.MercurialEclipse.menu.AddBranchHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- DisconnectHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.DisconnectHandler"
                 class="com.vectrace.MercurialEclipse.menu.DisconnectHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- QImportHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.QImportHandler"
                 class="com.vectrace.MercurialEclipse.menu.QImportHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- QInitHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.QInitHandler"
                 class="com.vectrace.MercurialEclipse.menu.QInitHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- QNewHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.QNewHandler"
                 class="com.vectrace.MercurialEclipse.menu.QNewHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- QRefreshHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.QRefreshHandler"
                 class="com.vectrace.MercurialEclipse.menu.QRefreshHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- QDeleteHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.QDeleteHandler"
                 class="com.vectrace.MercurialEclipse.menu.QDeleteHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <!-- RefreshStatusHandler -->
        <handler commandId="com.vectrace.MercurialEclipse.menu.RefreshStatusHandler"
                 class="com.vectrace.MercurialEclipse.menu.RefreshStatusHandler">
            <enabledWhen>
                <and>
                    <count value="1"/>                  
                </and>
            </enabledWhen>
        </handler>
        <handler commandId="com.vectrace.MercurialEclipse.menu.ExportPatchHandler"
                 class="com.vectrace.MercurialEclipse.menu.ExportPatchHandler"/>
	</extension>

	<extension point="org.eclipse.ui.menus">
		<menuContribution locationURI="popup:org.eclipse.ui.popup.any?after=additions">
			<menu label="Team" id="team.main">
				<separator name="group1" visible="true"/>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.CommitMergeHandler"
          icon="icons/actions/commit.gif"
          label="Commit Merge...">
					<visibleWhen>
						<and>
							<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
							<reference definitionId="com.vectrace.MercurialEclipse.def.merging"/>
						</and>
					</visibleWhen>
				</command>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.CommitHandler"
          icon="icons/actions/commit.gif"
          label="Commit...">
					<visibleWhen>
						<and>
							<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
							<reference definitionId="com.vectrace.MercurialEclipse.def.notMerging"/>
						</and>
					</visibleWhen>
				</command>				
				<command
          commandId="com.vectrace.MercurialEclipse.menu.PushHandler"
          icon="icons/actions/commit.gif"
          label="Push...">
					<visibleWhen>
						<and>
							<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
							<reference definitionId="com.vectrace.MercurialEclipse.def.notMerging"/>
						</and>
					</visibleWhen>
				</command>		
				<command
          commandId="com.vectrace.MercurialEclipse.menu.PullHandler"
          icon="icons/actions/update.gif"
          label="Pull...">
					<visibleWhen>
						<and>
							<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
							<reference definitionId="com.vectrace.MercurialEclipse.def.notMerging"/>
						</and>
					</visibleWhen>
				</command>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.UpdateHandler"
          icon="icons/actions/update.gif"
          label="Update">
					<visibleWhen>
						<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
					</visibleWhen>
				</command>
    <command
          commandId="com.vectrace.MercurialEclipse.menu.SwitchHandler"
          icon="icons/actions/switch.gif"
          label="Update To...">
       <visibleWhen>
          <reference
                definitionId="com.vectrace.MercurialEclipse.def.mercurial">
          </reference>
       </visibleWhen>
    </command>
				
                
				<separator name="group2" visible="false"/><!-- TODO visible="true" -->
				<command commandId="com.vectrace.MercurialEclipse.menu.ExportPatchHandler"
					icon="icons/export.gif">
					<visibleWhen>
						<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
					</visibleWhen>
				</command>
				<separator name="group3" visible="true"/>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.TagHandler"
          icon="icons/tags.gif"
          label="Tags...">
					<visibleWhen>
						<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
					</visibleWhen>
				</command>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.BookmarkHandler"
          icon="icons/actions/tag.gif"
          label="Bookmarks...">
                    <visibleWhen>
                        <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                    </visibleWhen>
                </command>
    <command
          commandId="com.vectrace.MercurialEclipse.menu.AddBranchHandler"
          icon="icons/actions/branch.gif"
          label="Branch...">
       <visibleWhen>
          <reference
                definitionId="com.vectrace.MercurialEclipse.def.mercurial">
          </reference>
       </visibleWhen>
    </command>
    <command
          commandId="com.vectrace.MercurialEclipse.menu.MergeHandler"
          icon="icons/actions/merge.gif"
          label="Merge...">
       <visibleWhen>
          <reference
                definitionId="com.vectrace.MercurialEclipse.def.mercurial">
          </reference>
       </visibleWhen>
    </command>
    <command
          commandId="com.vectrace.MercurialEclipse.menu.RebaseHandler"
          icon="icons/actions/merge.gif"
          label="Rebase...">
       <visibleWhen>
          <and>
             <reference
                   definitionId="com.vectrace.MercurialEclipse.def.mercurial">
             </reference>
             <reference
                   definitionId="com.vectrace.MercurialEclipse.def.notMerging">
             </reference>
          </and>
       </visibleWhen>
    </command>
	<separator name="group4" visible="true"/>				
	<command
          commandId="com.vectrace.MercurialEclipse.menu.ShowAnnotationHandler"
          icon="icons/annotate.gif"
          label="Show Annotation">
					<visibleWhen>
					<and>
						<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
						<reference definitionId="com.vectrace.MercurialEclipse.def.file"/>
					</and>
					</visibleWhen>
				</command>
				<separator name="group5" visible="true"/>
				<menu label="Undo" id="team.main.com.vectrace.MercurialEclipse.menu.undo" icon="icons/undo_edit.gif">  
    				<command
              commandId="com.vectrace.MercurialEclipse.menu.BackoutHandler"
              icon="icons/actions/revert.gif"
              label="Backout...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>
                    <command
                          commandId="com.vectrace.MercurialEclipse.menu.RollbackHandler"
                          icon="icons/actions/revert.gif"
                          label="Rollback">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>
                    <command
                          commandId="com.vectrace.MercurialEclipse.menu.StripHandler"
                          icon="icons/actions/revert.gif"
                          label="Strip...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>
                </menu>				
				<separator name="group6" visible="true"/>				                               
				<separator name="group7" visible="true"/>
				<separator name="group8" visible="true"/>
				<menu
                      id="team.main.com.vectrace.MercurialEclipse.menu.extensions"
                      label="Extensions">
                       <menu
                      id="team.main.com.vectrace.MercurialEclipse.menu.mqueue"
                      label="mqueue">       
                    <command
                          commandId="com.vectrace.MercurialEclipse.menu.QImportHandler"
                          label="qimport...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>                  
                    <command
                    commandId="com.vectrace.MercurialEclipse.menu.QInitHandler"
                    label="qinit...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>
                    <command
                          commandId="com.vectrace.MercurialEclipse.menu.QNewHandler"
                          label="qnew...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>
                    <command
                          commandId="com.vectrace.MercurialEclipse.menu.QRefreshHandler"
                          label="qrefresh...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>
                    <command
                          commandId="com.vectrace.MercurialEclipse.menu.QDeleteHandler"
                          label="qdelete...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>
                </menu>      
				    <command
                        commandId="com.vectrace.MercurialEclipse.menu.SignHandler"
                          icon="icons/clcl16/deadlock_view.gif"
                          label="Sign...">
                                    <visibleWhen>
                                        <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                                    </visibleWhen>
                    </command>
                    <command
                          commandId="com.vectrace.MercurialEclipse.menu.TransplantHandler"
                          icon="icons/branches_rep.gif"
                          label="Transplant...">
                        <visibleWhen>
                            <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                        </visibleWhen>
                    </command>	
                    </menu>			
				<separator name="group9" visible="true"/>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.ServeHandler"
          icon="icons/cview16/share_project.gif"
          label="Serve...">
                    <visibleWhen>
                        <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                    </visibleWhen>
                </command>
    <command
          commandId="com.vectrace.MercurialEclipse.menu.SyncHandler"
          icon="icons/actions/synch.gif"
          label="Synchronize...">
       <visibleWhen>
          <and>
             <reference
                   definitionId="com.vectrace.MercurialEclipse.def.mercurial">
             </reference>
          </and>
       </visibleWhen>
    </command>				
				
				<separator name="group10" visible="true"/>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.AddHandler"
          icon="icons/add.gif"
          label="Add...">
					<visibleWhen>
						<reference definitionId="com.vectrace.MercurialEclipse.def.hgUnknown"/>
					</visibleWhen>
				</command>
				<!--
				<command commandId="com.vectrace.MercurialEclipse.handlers.RemoveHandler"/>
				-->
				<command
          commandId="com.vectrace.MercurialEclipse.menu.HgIgnoreHandler"
          label="Ignore...">
					<visibleWhen>
						<reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
					</visibleWhen>
				</command>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.RefreshStatusHandler"
          icon="icons/clcl16/refresh.gif"
          label="Refresh Status">
                    <visibleWhen>
                        <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                    </visibleWhen>
                </command>
				<command
          commandId="com.vectrace.MercurialEclipse.menu.DisconnectHandler"
          label="Disconnect">
                    <visibleWhen>
                        <reference definitionId="com.vectrace.MercurialEclipse.def.mercurial"/>
                    </visibleWhen>
                </command>
			</menu>
		</menuContribution>
	</extension>

   <extension
         point="org.eclipse.ui.popupMenus">

<!--            All Team menu                     -->
              
       <objectContribution
           adaptable="true"
           objectClass="org.eclipse.core.resources.IResource"
           id="com.vectrace.MercurialEclipse.IResourceContributions">
           <filter
               name="projectPersistentProperty"
               value="org.eclipse.team.core.repository=com.vectrace.MercurialEclipse.team.MercurialTeamProvider">
           </filter>
           
           <!-- Team -->
           <action
               label="Remove from Version Control"
               class="com.vectrace.MercurialEclipse.team.ActionRemove"
               icon="icons/rem_co.gif"
               tooltip="hg remove"
               menubarPath="team.main/group10"
               id="com.vectrace.MercurialEclipse.team.ActionRemove">
           </action>           
           <action
               label="Show &amp;History"
               class="com.vectrace.MercurialEclipse.team.ActionChangeLog"
               icon="icons/history.gif"
               tooltip="hg log"
               menubarPath="team.main/group4"
               id="com.vectrace.MercurialEclipse.team.ActionChangeLog">
           </action>
           <action
               label="&amp;Revert..."
               class="com.vectrace.MercurialEclipse.team.ActionRevert"
               icon="icons/actions/revert.gif"
               tooltip="hg revert"
               menubarPath="team.main/group5"
               id="com.vectrace.MercurialEclipse.team.ActionRevert">
           </action>
           <action
               label="&amp;Import patch..."
               class="com.vectrace.MercurialEclipse.team.ActionImport"
               tooltip="Import patch from file (hg import)"
               icon="icons/import.gif"
               menubarPath="team.main/group2"
               id="com.vectrace.MercurialEclipse.team.ActionImport">
           </action>           
      </objectContribution>    
      
      <!-- File Team Menu -->
      <objectContribution
            adaptable="true"
            objectClass="org.eclipse.core.resources.IFile"
            id="com.vectrace.MercurialEclipse.IFileContributions">
           <filter
               name="projectPersistentProperty"
               value="org.eclipse.team.core.repository=com.vectrace.MercurialEclipse.team.MercurialTeamProvider">
           </filter>            
                 <!-- Compare -->
           <action
               label="Another Changeset"
               class="com.vectrace.MercurialEclipse.team.CompareWithAction"
               icon="icons/compare_view.gif"
               tooltip="hg diff"
               menubarPath="compareWithMenu/compareWithGroup"
               id="com.vectrace.MercurialEclipse.team.CompareWithAction"
               enablesFor="1">
           </action>
           <action
               label="Parent Changeset"
               class="com.vectrace.MercurialEclipse.team.CompareAction"
               icon="icons/compare_view.gif"
               tooltip="hg diff"
               menubarPath="compareWithMenu/compareWithGroup"
               id="com.vectrace.MercurialEclipse.team.CompareAction"
               enablesFor="1">
           </action>
      </objectContribution>
   </extension>

   <extension point="org.eclipse.ui.preferencePages">
      <page class="com.vectrace.MercurialEclipse.preferences.GeneralPreferencePage"
            id="com.vectrace.MercurialEclipse.prefspage"
            category="org.eclipse.team.ui.TeamPreferences"
            name="Mercurial Eclipse"/>
      <page class="com.vectrace.MercurialEclipse.preferences.TimeoutPreferencePage"
            id="com.vectrace.MercurialEclipse.prefspage.Timeouts"
            category="com.vectrace.MercurialEclipse.prefspage"
            name="Timeouts"/>  
      <page class="com.vectrace.MercurialEclipse.preferences.PerformancePreferencePage"
            id="com.vectrace.MercurialEclipse.prefspage.Performance"
            category="com.vectrace.MercurialEclipse.prefspage"
            name="Performance"/>    
      <page class="com.vectrace.MercurialEclipse.preferences.ConsolePreferencesPage"
            id="com.vectrace.MercurialEclipse.prefspage.Console"
            category="com.vectrace.MercurialEclipse.prefspage"
            name="Console"/>     
                      
   </extension>

   <extension point="org.eclipse.core.runtime.preferences">
      <initializer class="com.vectrace.MercurialEclipse.preferences.PreferenceInitializer"/>
   </extension>
   
   <extension point="org.eclipse.ui.importWizards">
      <category
            id="com.vectrace.MercurialEclipse.wizards.sampleCategory"
            name="Mercurial"/>
      <wizard
            category="com.vectrace.MercurialEclipse.wizards.sampleCategory"
            class="com.vectrace.MercurialEclipse.wizards.CloneRepoWizard"
            icon="icons/mercury_Hg.png"
            id="com.vectrace.MercurialEclipse.wizards.ImportWizard"
            name="Clone Repository using Mercurial">
         <description>
            Import a file from the local file system into the workspace.
         </description>
      </wizard>
   </extension>
   

   <extension point="org.eclipse.ui.newWizards">
      <category
            id="com.vectrace.MercurialEclipse"
            name="Mercurial"/>
      <wizard
            canFinishEarly="false"
            category="com.vectrace.MercurialEclipse"
            class="com.vectrace.MercurialEclipse.wizards.CloneRepoWizard"
            icon="icons/mercury_Hg.png"
            id="com.vectrace.MercurialEclipse.wizards.NewHgProjectWizard"
            name="Clone Repository using Mercurial"
            project="true"/>
   </extension>

   <extension
         point="org.eclipse.ui.workbench.texteditor.quickDiffReferenceProvider">
      <referenceprovider
            label="Hg Quick Diff"
            class="com.vectrace.MercurialEclipse.annotations.HgPristineCopyQuickDiffProvider"
            id="com.vectrace.MercurialEclipse.annotations.HgReferenceProvider">
      </referenceprovider>
   </extension>

   <!-- Adapters -->
   <extension point="org.eclipse.core.runtime.adapters">
     <factory
       adaptableType="org.eclipse.team.core.history.provider.FileHistoryProvider"
       class="com.vectrace.MercurialEclipse.AdapterFactory">
       <adapter type="org.eclipse.team.ui.history.IHistoryPageSource"/>
     </factory>
    <factory
       adaptableType="org.eclipse.core.resources.IResource"
       class="com.vectrace.MercurialEclipse.ResourceAdapterFactory">
       <adapter type="org.eclipse.core.resources.IResource"/>
     </factory>
   </extension>
   
   <!-- Views -->
   
   <extension point="org.eclipse.ui.views">
      <view
        class="com.vectrace.MercurialEclipse.views.MergeView"
        id="com.vectrace.MercurialEclipse.views.MergeView"
        icon="icons/branches_rep.gif"
        name="Merge">
      </view>
      
      <view
            name="Repository View"            
            icon="icons/cview16/repo_rep.gif"
            class="com.vectrace.MercurialEclipse.repository.RepositoriesView"
            id="com.vectrace.MercurialEclipse.repository.RepositoriesView">
      </view>
      <view
            name="Patch Queue View"          
            class="com.vectrace.MercurialEclipse.views.PatchQueueView"
            id="com.vectrace.MercurialEclipse.views.PatchQueueView">
      </view>
   </extension>
   <extension
         point="org.eclipse.ui.console.consoleFactories">
      <consoleFactory
            class="com.vectrace.MercurialEclipse.views.console.HgConsoleFactory"
            icon="icons/mercurialeclipse.png"
            label="Mercurial Console">
      </consoleFactory>
   </extension>
   
</plugin>
